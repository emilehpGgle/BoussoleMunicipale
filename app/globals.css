@tailwind base;
@tailwind components;
@tailwind utilities;

/* Performance: Isolation des styles non-critiques */

@layer base {
  :root {
    /* Palette palette2.0.scss - Élimination complète du bleu */
    --background: 27 60% 97%; /* Isabelline off-white (#FCF7F3) */
    --foreground: 0 0% 13%; /* Eerie Black pour texte (#222222) */

    --card: 0 100% 100%; /* White pur (#FFFEFE) */
    --card-foreground: 0 0% 13%; /* Eerie Black */

    --popover: 0 100% 100%; /* White pur */
    --popover-foreground: 0 0% 13%; /* Eerie Black */

    --primary: 184 91% 14%; /* Midnight Green - Teal principal (#04454A) */
    --primary-foreground: 0 100% 100%; /* White pur */

    --secondary: 180 75% 95%; /* Azure Web - Teal ultra-clair (#EAFCFC) */
    --secondary-foreground: 0 0% 13%; /* Eerie Black */

    --accent: 180 75% 95%; /* Azure Web - Teal clair */
    --accent-foreground: 0 0% 13%; /* Eerie Black */

    --teal-special: 184 91% 14%; /* Midnight Green (#04454A) */
    --teal-special-foreground: 0 100% 100%; /* White pur */

    --muted: 180 75% 95%; /* Azure Web - Teal ultra-clair */
    --muted-foreground: 0 0% 45%; /* Gris neutre */

    --destructive: 0 84.2% 60.2%; /* Rouge doux pour erreurs */
    --destructive-foreground: 0 100% 100%; /* White pur */

    --border: 180 75% 90%; /* Bordure teal très subtile */
    --input: 180 75% 90%; /* Input teal subtil */
    --ring: 184 91% 14%; /* Focus ring teal foncé */

    --radius: 0.75rem; /* Coins arrondis (12px) */

    --chart-1: 12 76% 61%;
    --chart-2: 173 58% 39%;
    --chart-3: 197 37% 24%;
    --chart-4: 43 74% 66%;
    --chart-5: 27 87% 67%;
    --color-1: 184 95% 8%; /* Midnight Green très foncé pour plus de contraste */
    --color-2: 184 91% 14%; /* Midnight Green principal #04454A */
    --color-3: 184 70% 35%; /* Teal intermédiaire plus vibrant */
    --color-4: 180 80% 70%; /* Teal clair plus lumineux */
    --color-5: 180 90% 88%; /* Azure Web plus contrasté */
  }

  .dark {
    --background: 222.2 84% 4.9%;
    --foreground: 210 40% 98%;
    --card: 222.2 84% 4.9%;
    --card-foreground: 210 40% 98%;
    --popover: 222.2 84% 4.9%;
    --popover-foreground: 210 40% 98%;
    --primary: 184 91% 14%; /* Midnight Green - même couleur qu'en light mode */
    --primary-foreground: 0 100% 100%; /* White pur */
    --secondary: 180 75% 95%; /* Azure Web */
    --secondary-foreground: 0 0% 13%; /* Eerie Black */
    --muted: 217.2 32.6% 17.5%;
    --muted-foreground: 215 20.2% 65.1%;
    --accent: 180 75% 95%; /* Azure Web */
    --accent-foreground: 0 0% 13%; /* Eerie Black */
    --destructive: 0 62.8% 30.6%;
    --destructive-foreground: 210 40% 98%;
    --border: 217.2 32.6% 17.5%;
    --input: 217.2 32.6% 17.5%;
    --ring: 184 91% 14%; /* Focus ring teal foncé - même que primary */
    --chart-1: 184 91% 14%; /* Teal principal */
    --chart-2: 160 60% 45%;
    --chart-3: 30 80% 55%;
    --chart-4: 280 65% 60%;
    --chart-5: 340 75% 55%;
  }
  .theme {
    --animate-rainbow: rainbow var(--speed, 6s) infinite linear;
  }
}

@layer base {
  * {
    @apply border-border;
  }
  body {
    @apply bg-background text-foreground font-sans;
    font-size: 16px;
    line-height: 1.6;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }
  h1,
  h2,
  h3 {
    @apply tracking-tight font-bold text-foreground;
  }
  h4,
  h5,
  h6 {
    @apply tracking-tight font-semibold text-foreground;
  }

  h1 {
    @apply text-3xl md:text-4xl lg:text-h1-lg leading-tight;
  }
  h2 {
    @apply text-2xl md:text-3xl;
  }
  h3 {
    @apply text-xl md:text-2xl;
  }

  /* Smooth transitions for links */
  a {
    @apply transition-colors duration-200 ease-in-out;
  }

  /* Couleur de sélection de texte globale */
  ::selection {
    background-color: hsl(var(--primary) / 0.3);
    color: hsl(var(--primary-foreground));
  }

  ::-moz-selection {
    background-color: hsl(var(--primary) / 0.3);
    color: hsl(var(--primary-foreground));
  }

  /* Couleur de sélection spécifique aux inputs */
  input::selection,
  textarea::selection {
    background-color: hsl(var(--primary) / 0.2);
    color: hsl(var(--foreground));
  }

  input::-moz-selection,
  textarea::-moz-selection {
    background-color: hsl(var(--primary) / 0.2);
    color: hsl(var(--foreground));
  }

  /* General button enhancements - optimisés */
  .btn-base-effects {
    @apply transition-colors duration-150 ease-out;
  }
  .btn-hover-lift {
    @apply hover:-translate-y-0.5 hover:shadow-md transition-transform duration-150 ease-out;
  }
  .btn-primary-hover-effects {
    @apply hover:brightness-105 transition-all duration-150 ease-out;
  }

  /* Enhanced button borders - subtle but visible */
  .btn-enhanced-border {
    @apply border-2 border-border/80 hover:border-primary/50 transition-all duration-200;
  }

  /* Boutons tactiles optimisés - respect des guidelines d'accessibilité */
  .btn-touch-optimized {
    min-height: 44px;
    min-width: 44px;
    display: flex;
    align-items: center;
    justify-content: center;
    touch-action: manipulation;
    -webkit-tap-highlight-color: rgba(0, 0, 0, 0.1);
  }

  /* Zones tactiles étendues pour petits boutons */
  .btn-extended-touch::before {
    content: '';
    position: absolute;
    top: -8px;
    left: -8px;
    right: -8px;
    bottom: -8px;
    z-index: -1;
  }

  /* Feedback tactile amélioré */
  .btn-touch-feedback {
    @apply active:scale-95 transition-transform duration-75 ease-out;
  }

  /* Animation de bordure pour les boutons */
  .animate-border-pulse {
    animation: border-pulse 2s ease-in-out infinite;
  }

  /* Boutons de navigation questionnaire */
  .nav-btn-mobile {
    min-height: 48px;
    padding: 0.75rem 1rem;
    font-size: 0.9rem;
    border-radius: 0.75rem;
  }

  /* Options de questionnaire tactiles */
  .option-btn-mobile {
    min-height: 52px;
    padding: 0.875rem 1rem;
    font-size: 0.9rem;
    line-height: 1.4;
    border-radius: 0.75rem;
    text-align: left;
    display: flex;
    align-items: center;
  }

  /* General card enhancements */
  .card-interactive-effects {
    @apply transition-all duration-200 ease-out hover:shadow-md;
  }

  /* Classes utilitaires pour teal spécial */
  .bg-teal-special {
    background-color: hsl(var(--teal-special));
  }
  .text-teal-special {
    color: hsl(var(--teal-special));
  }
  .border-teal-special {
    border-color: hsl(var(--teal-special));
  }

  /* Variables de performance - animations questionnaire dans styles.css séparé */
  :root {
    --transition-enter: cubic-bezier(0.25, 0.46, 0.45, 0.94);
    --transition-exit: cubic-bezier(0.55, 0.085, 0.68, 0.53);
    --transition-duration-enter: 350ms;
    --transition-duration-exit: 250ms;
  }

  /* Support accessibilité - respect des préférences utilisateur */
  @media (prefers-reduced-motion: reduce) {
    :root {
      --transition-duration-enter: 150ms;
      --transition-duration-exit: 100ms;
    }

    .question-sweep-enter,
    .question-sweep-exit,
    .question-sweep-enter-back,
    .question-sweep-exit-back,
    .question-content-enter,
    .option-button-enter {
      animation-duration: 150ms;
      animation-timing-function: ease-out;
    }

    @keyframes questionSweepIn {
      0% { opacity: 0; transform: translateX(10px); }
      100% { opacity: 1; transform: translateX(0); }
    }

    @keyframes questionSweepOut {
      0% { opacity: 1; transform: translateX(0); }
      100% { opacity: 0; transform: translateX(-10px); }
    }

    @keyframes questionSweepInBack {
      0% { opacity: 0; transform: translateX(-10px); }
      100% { opacity: 1; transform: translateX(0); }
    }

    @keyframes questionSweepOutBack {
      0% { opacity: 1; transform: translateX(0); }
      100% { opacity: 0; transform: translateX(10px); }
    }

    @keyframes contentFadeUp {
      0% { opacity: 0; }
      100% { opacity: 1; }
    }

    @keyframes optionCascade {
      0% { opacity: 0; }
      100% { opacity: 1; }
    }
  }

  /* Animation pour les messages d'erreur */
  @keyframes slideInFromRight {
    0% {
      opacity: 0;
      transform: translateX(100px);
    }
    100% {
      opacity: 1;
      transform: translateX(0);
    }
  }

  .animate-slideInFromRight {
    animation: slideInFromRight 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards;
  }

  /* Animation douce style nuage pour le cerf-volant */
  @keyframes kiteFloat {
    0% {
      transform: translateY(0px) translateX(0px) rotate(0deg);
    }
    25% {
      transform: translateY(-3px) translateX(2px) rotate(0.3deg);
    }
    50% {
      transform: translateY(-5px) translateX(0px) rotate(0deg);
    }
    75% {
      transform: translateY(-3px) translateX(-2px) rotate(-0.3deg);
    }
    100% {
      transform: translateY(0px) translateX(0px) rotate(0deg);
    }
  }

  .kite-animation {
    animation: kiteFloat 12s cubic-bezier(0.25, 0.46, 0.45, 0.94) infinite;
  }

  /* Conteneurs avec bordure dessin d'enfant */
  .decorative-frame-left {
    border-radius: 60% 40% 65% 35% / 45% 70% 30% 55%;
    border: 3px solid #04454A;
    box-shadow: 0 0 0 1px rgba(4, 69, 74, 0.3);
    padding: 0;
    overflow: hidden;
  }

  .decorative-frame-right {
    border-radius: 55% 65% 40% 60% / 70% 30% 75% 25%;
    border: 3px solid #04454A;
    box-shadow: 0 0 0 1px rgba(4, 69, 74, 0.3);
    padding: 0;
    overflow: hidden;
  }

  /* Images à l'intérieur des cadres */
  .decorative-image-left {
    border-radius: 60% 40% 65% 35% / 45% 70% 30% 55%;
  }

  .decorative-image-right {
    border-radius: 55% 65% 40% 60% / 70% 30% 75% 25%;
  }

  /* Amélioration responsive pour les images */
  @media (max-width: 640px) {
    .relative img {
      max-width: 100%;
      height: auto;
    }

    /* Ajustement des hauteurs sur mobile */
    .relative[style*="height"] {
      min-height: 200px !important;
    }
  }

  /* Images décoratives pour mobile - subtiles en arrière-plan */
  .mobile-decorative-bg {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    opacity: 0.03;
    z-index: -1;
    pointer-events: none;
    background-size: contain;
    background-repeat: no-repeat;
    background-position: center;
  }

  .mobile-decorative-corner {
    position: fixed;
    opacity: 0.08;
    z-index: 1;
    pointer-events: none;
    border-radius: 20px;
  }

  .mobile-decorative-corner.top-right {
    top: 80px;
    right: 10px;
    width: 120px;
    height: 120px;
  }

  .mobile-decorative-corner.bottom-left {
    bottom: 100px;
    left: 10px;
    width: 100px;
    height: 100px;
  }

  .mobile-decorative-corner.bottom-right {
    bottom: 20px;
    right: 20px;
    width: 80px;
    height: 80px;
  }

  /* Gradient overlay pour améliorer la lisibilité */
  .mobile-content-overlay {
    position: relative;
    z-index: 2;
  }

  /* SYSTÈME DE GLOW SUBTIL POUR LES MODULES */
  .subtle-glow {
    box-shadow: 
      0 0 0 1px hsl(var(--primary) / 0.1),
      0 1px 3px rgba(0, 0, 0, 0.1);
    transition: box-shadow 0.2s ease-in-out;
  }

  .subtle-glow:hover {
    box-shadow: 
      0 0 0 1px hsl(var(--primary) / 0.2),
      0 4px 12px hsl(var(--primary) / 0.08),
      0 2px 4px rgba(0, 0, 0, 0.1);
  }

  /* Variante pour les questions/cartes principales */
  .question-glow {
    box-shadow: 
      0 0 0 1px hsl(var(--primary) / 0.05),
      0 2px 8px rgba(0, 0, 0, 0.08);
    border: 1px solid hsl(var(--primary) / 0.1);
  }

  .question-glow:hover {
    box-shadow: 
      0 0 0 1px hsl(var(--primary) / 0.15),
      0 4px 16px hsl(var(--primary) / 0.06),
      0 2px 4px rgba(0, 0, 0, 0.1);
    border-color: hsl(var(--primary) / 0.2);
  }

  /* Contraintes pour éviter les débordements - DOMAIN FIX */
  .mobile-constrained {
    max-width: 100vw !important;
    width: 100% !important;
    overflow-x: hidden !important;
    box-sizing: border-box !important;
  }

  .section-contained {
    position: relative;
    overflow: hidden;
    width: 100% !important;
    max-width: 100% !important;
  }

  /* Version spéciale pour sections avec RainbowButtons */
  .section-contained-rainbow {
    position: relative;
    overflow: visible; /* Permet aux RainbowButtons de déborder légèrement */
    width: 100% !important;
    max-width: 100% !important;
  }

  /* Amélioration des couleurs et contraste sur mobile */
  @media (max-width: 768px) {
    /* Texte avec contraste amélioré */
    .text-high-contrast {
      color: hsl(222.2, 84%, 4.9%);
      font-weight: 500;
    }

    /* Liens avec meilleure visibilité */
    .link-mobile-optimized {
      color: hsl(221.2, 83.2%, 45%);
      text-decoration: underline;
      text-decoration-thickness: 2px;
      text-underline-offset: 3px;
    }

    /* Ajout de couleurs subtiles aux cartes */
    .card-color-accent {
      background: linear-gradient(135deg, 
        hsl(var(--background)) 0%, 
        hsl(var(--primary) / 0.02) 100%);
      border-left: 3px solid hsl(var(--primary) / 0.3);
    }

    /* Bordures colorées pour différencier les sections */
    .mobile-section-border {
      border-left: 4px solid hsl(var(--primary));
      padding-left: 16px;
    }

    /* Backgrounds dégradés subtils */
    .mobile-gradient-bg {
      background: linear-gradient(135deg, 
        hsl(var(--background)) 0%, 
        hsl(var(--primary) / 0.03) 50%,
        hsl(var(--teal-special) / 0.02) 100%);
    }

    /* Ombres plus prononcées pour meilleure séparation */
    .shadow-mobile-enhanced {
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 
                  0 2px 4px -1px rgba(0, 0, 0, 0.06),
                  0 0 0 1px rgba(0, 0, 0, 0.05);
    }

    /* États des boutons avec contraste amélioré */
    .btn-selected-mobile {
      background: hsl(var(--primary));
      color: white;
      border: 2px solid hsl(var(--primary));
      font-weight: 600;
    }

    .btn-unselected-mobile {
      background: white;
      color: hsl(222.2, 84%, 4.9%);
      border: 2px solid hsl(214.3, 31.8%, 85%);
      font-weight: 500;
    }

    .btn-disabled-mobile {
      background: hsl(210, 40%, 96%);
      color: hsl(215.4, 16.3%, 56.9%);
      border: 1px solid hsl(214.3, 31.8%, 91.4%);
      opacity: 0.7;
    }

    /* Messages d'erreur/succès avec contraste amélioré */
    .alert-mobile-error {
      background: hsl(0, 84.2%, 96%);
      color: hsl(0, 84.2%, 35%);
      border: 1px solid hsl(0, 84.2%, 85%);
    }

    .alert-mobile-success {
      background: hsl(142, 76%, 96%);
      color: hsl(142, 76%, 30%);
      border: 1px solid hsl(142, 76%, 85%);
    }
  }

  /* Contraintes strictes pour mobile */
  @media (max-width: 768px) {
    * {
      max-width: 100%;
      box-sizing: border-box;
    }

    .container {
      padding-left: 1rem !important;
      padding-right: 1rem !important;
      margin-left: auto !important;
      margin-right: auto !important;
      max-width: 100% !important;
      width: 100% !important;
      overflow-x: hidden !important;
      box-sizing: border-box !important;
    }

    .grid {
      grid-template-columns: 1fr;
      gap: 1.5rem;
      width: 100%;
    }

    /* Assurer que les images ne débordent jamais */
    img, .relative {
      max-width: 100%;
      width: 100%;
    }

    /* Prévenir les débordements de texte */
    h1, h2, h3, h4, h5, h6, p, span, div {
      word-wrap: break-word;
      overflow-wrap: break-word;
      hyphens: auto;
      max-width: 100%;
    }

    /* Titres spécifiquement optimisés pour mobile */
    h1 {
      font-size: clamp(1.75rem, 4vw, 2.5rem);
      line-height: 1.2;
    }

    h2 {
      font-size: clamp(1.5rem, 3.5vw, 2rem);
      line-height: 1.3;
    }

    /* Boutons qui débordent */
    .btn-mobile-fit {
      width: 100%;
      max-width: 100%;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
  }

  /* Optimisations pour très petits écrans (< 360px) */
  @media (max-width: 360px) {
    /* Réduction des paddings/margins pour économiser l'espace */
    .container {
      padding-left: 0.75rem;
      padding-right: 0.75rem;
    }

    /* Textes plus compacts */
    h1 {
      font-size: 1.75rem;
      line-height: 1.2;
    }

    h2 {
      font-size: 1.5rem;
      line-height: 1.3;
    }

    h3 {
      font-size: 1.25rem;
      line-height: 1.3;
    }

    /* Boutons plus compacts mais toujours accessibles */
    .btn-compact-mobile {
      padding: 0.625rem 0.875rem;
      font-size: 0.875rem;
      min-height: 44px;
    }

    /* Cards avec moins de padding */
    .card-compact-mobile {
      padding: 0.75rem;
    }

    /* Navigation header plus compacte */
    .mobile-header-compact {
      height: 3.5rem;
    }

    .mobile-logo-compact {
      width: 8rem;
    }

    /* Grid avec moins d'espacement */
    .grid {
      gap: 1rem;
    }

    /* Progress bar plus fine */
    .progress-compact {
      height: 0.375rem;
    }

    /* Modal plus petit */
    .modal-compact {
      margin: 0.5rem;
      max-height: calc(100vh - 1rem);
    }
  }
}

/* Optimisations pour le questionnaire compact */
@layer utilities {
  .questionnaire-compact {
    /* Utiliser la hauteur complète de l'écran */
    min-height: 100vh;
    min-height: 100dvh; /* Support pour les navigateurs modernes */
  }
}

/* Optimisations responsive pour les petits écrans */
@media (max-height: 700px) {
  .questionnaire-compact .card-question {
    @apply p-3;
  }

  .questionnaire-compact .question-title {
    @apply text-base leading-snug;
  }

  .questionnaire-compact .option-button {
    @apply py-2 text-sm;
  }

  .questionnaire-compact .question-grid {
    @apply gap-1;
  }
}

@media (max-height: 600px) {
  .questionnaire-compact {
    @apply py-2;
  }

  .questionnaire-compact .progress-container {
    @apply mb-2;
  }

  .questionnaire-compact .card-question {
    @apply p-2;
  }

  .questionnaire-compact .question-header {
    @apply mb-2;
  }

  .questionnaire-compact .navigation-buttons {
    @apply gap-1 pt-1;
  }
}

/* Animation shine pour bouton Commencer */
@keyframes shine-slow {
  0% {
    transform: translateX(-100%);
  }
  100% {
    transform: translateX(100%);
  }
}

.animate-shine-slow {
  animation: shine-slow 2.5s ease-in-out infinite;
  animation-delay: 1s;
}

/* Animation border-pulse pour boutons Commencer - Effet dimming light subtil */
@keyframes border-pulse {
  0%, 100% { 
    border-color: #04454A; /* midnight-green */
  }
  50% { 
    border-color: #056B72; /* midnight-green légèrement éclairci pour effet dimming subtil */
  }
}

@layer base {
  * {
    @apply border-border;
  }
  body {
    @apply bg-background text-foreground;
  }
}

@theme inline {
  @keyframes rainbow {
  0% {
    background-position: 0%;
    }
  100% {
    background-position: 200%;
    }
  }

  @keyframes border-pulse {
    0%, 100% {
      border-color: hsl(var(--primary) / 0.5);
      box-shadow: 0 0 0 0 hsl(var(--primary) / 0.3);
    }
    50% {
      border-color: hsl(var(--primary) / 0.8);
      box-shadow: 0 0 0 4px hsl(var(--primary) / 0.1);
    }
  }
}